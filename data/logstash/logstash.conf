input {
    tcp {
        codec => "json"
        port => 5044
    }
    file {
        path => ["/var/log/nginx/access-log.json"]
        codec => "json"
        tags => ["nginx"]
    }
}
filter {
    if "ugc_uvicorn" in [tags] {
        grok {
            match => {
                "message" => "%{HOSTPORT:http_host} - \"%{WORD:http_action} %{URIPATH:http_path} HTTP/%{NUMBER:http_version}\" %{NUMBER:http_status_code}"
            }
        }
    }
}
output {
    stdout {
    }
    if "nginx" in [tags] {
        elasticsearch {
            hosts => [ "${ES_HOST}" ]
            index => "nginx-%{+YYYY.MM}"
        }
    }
    else if "ugc_uvicorn" in [tags] {
        elasticsearch {
            hosts => [ "${ES_HOST}" ]
            index => "ugc-uvicorn-%{+YYYY.MM}"
        }
    }
} 